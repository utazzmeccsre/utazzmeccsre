<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
   
    <title>Meccsjegy fizetése – UtazzMeccsre</title>

    <!-- SEO meta -->
    <meta
      name="description"
      content="E-mailben kapott fizetési kód megadása és meccsjegy csomag bankkártyás fizetése SimplePay-en keresztül."
    />
    <link rel="canonical" href="https://utazzmeccsre.hu/fizetes.html" />

    <!-- Open Graph -->
    <meta property="og:type" content="website" />
    <meta property="og:title" content="Meccsjegy fizetése – UtazzMeccsre" />
    <meta
      property="og:description"
      content="Add meg az e-mailben kapott kódot, és fizesd ki bankkártyával a meccsjegy csomagodat SimplePay-en keresztül."
    />
    <meta property="og:url" content="https://utazzmeccsre.hu/fizetes.html" />
    <meta
      property="og:image"
      content="https://utazzmeccsre.hu/utazzmeccsre-logo.png"
    />

    <!-- Tailwind -->
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />

    <script>
      function toggleMenu() {
        const menu = document.getElementById("mobile-menu");
        if (menu) menu.classList.toggle("hidden");
      }
    </script>
  </head>

  <body class="bg-gray-50 text-gray-900">
    <!-- Navigációs sáv -->
    <header class="bg-white shadow-md w-full">
      <div
        class="container mx-auto flex items-center justify-between px-6 py-4"
      >
        <!-- Logó -->
        <a href="index.html" class="flex items-center">
          <img
            src="utazzmeccsre-logo.png"
            alt="UtazzMeccsre logó"
            class="h-20 w-auto"
          />
        </a>

        <!-- Asztali menü -->
        <nav class="space-x-6 hidden md:flex items-center">
          <a
            href="index.html"
            class="text-gray-700 hover:text-red-600 font-medium transition"
            >Főoldal</a
          >
          <a
            href="turak.html"
            class="text-gray-700 hover:text-red-600 font-medium transition"
            >Túrák</a
          >
          <a
            href="index.html#why-us"
            class="text-gray-700 hover:text-red-600 font-medium transition"
            >Miért minket?</a
          >
          <a
            href="rolunk.html"
            class="text-gray-700 hover:text-red-600 font-medium transition"
            >Rólunk</a
          >
          <a
            href="gyik.html"
            class="text-gray-700 hover:text-red-600 font-medium transition"
            >GYIK</a
          >
          <a
            href="index.html#contact"
            class="text-gray-700 hover:text-red-600 font-medium transition"
            >Kapcsolat</a
          >
          <a
            href="fizetes.html"
            class="text-red-600 font-semibold border-b-2 border-red-600 pb-0.5"
            >Fizetés</a
          >

          <!-- Pénznemváltó – itt csak dizájn, nem számolunk árakat -->
          <select
            id="currencySelector"
            class="border border-gray-300 rounded-md px-2 py-1 font-semibold text-gray-700 hover:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-500 transition"
          >
            <option value="HUF" selected>HUF</option>
            <option value="EUR">EUR</option>
          </select>
        </nav>

        <!-- Hamburger ikon mobilra -->
        <button
          onclick="toggleMenu()"
          class="md:hidden focus:outline-none text-gray-700 hover:text-red-600 transition"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-7 w-7"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 6h16M4 12h16M4 18h16"
            />
          </svg>
        </button>
      </div>

      <!-- Mobil menü -->
      <nav
        id="mobile-menu"
        class="hidden bg-white border-t border-gray-200 shadow-md md:hidden"
      >
        <div class="flex flex-col items-center space-y-3 py-4">
          <a
            href="index.html"
            onclick="toggleMenu()"
            class="text-gray-700 hover:text-red-600 font-medium"
            >Főoldal</a
          >
          <a
            href="turak.html"
            onclick="toggleMenu()"
            class="text-gray-700 hover:text-red-600 font-medium"
            >Túrák</a
          >
          <a
            href="index.html#why-us"
            onclick="toggleMenu()"
            class="text-gray-700 hover:text-red-600 font-medium"
            >Miért minket?</a
          >
          <a
            href="rolunk.html"
            onclick="toggleMenu()"
            class="text-gray-700 hover:text-red-600 font-medium"
            >Rólunk</a
          >
          <a
            href="gyik.html"
            onclick="toggleMenu()"
            class="text-gray-700 hover:text-red-600 font-medium"
            >GYIK</a
          >
          <a
            href="index.html#contact"
            onclick="toggleMenu()"
            class="text-gray-700 hover:text-red-600 font-medium"
            >Kapcsolat</a
          >
          <a
            href="fizetes.html"
            onclick="toggleMenu()"
            class="text-red-600 font-semibold"
            >Fizetés</a
          >

          <select
            id="currencySelectorMobile"
            class="border border-gray-300 rounded-md px-2 py-1 font-semibold text-gray-700 hover:border-red-500 focus:outline-none focus:ring-2 focus:ring-red-500 transition"
          >
            <option value="HUF" selected>HUF</option>
            <option value="EUR">EUR</option>
          </select>
        </div>
      </nav>
    </header>

    <!-- Hero / fejlécrész -->
    <section
      class="relative bg-cover bg-center h-64 flex items-center justify-center"
      style="
        background-image: url('https://img.freepik.com/free-photo/people-soccer-stadium_23-2151548562.jpg?semt=ais_hybrid&w=740&q=80');
      "
    >
      <div class="absolute inset-0 bg-black bg-opacity-60"></div>
      <div class="relative z-10 text-center px-4">
        <h1 class="text-3xl md:text-4xl font-bold text-white mb-3">
          Meccsjegy fizetése kóddal
        </h1>
        <p class="text-gray-200 max-w-2xl mx-auto">
          Ha már megkaptad tőlünk e-mailben a meccsre szóló csomagajánlatot és a
          hozzá tartozó fizetési kódot, itt tudod azt bankkártyával kifizetni
          SimplePay-en keresztül.
        </p>
      </div>
    </section>

    <!-- Kódos fizetés szekció -->
    <section class="py-16 px-6 md:px-20 bg-white">
      <div class="max-w-xl mx-auto bg-gray-50 shadow-lg rounded-2xl p-8">
        <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">
          Fizetés meccsjegy csomagra
        </h2>
        <p class="text-gray-600 text-sm mb-6 text-center">
          Írd be az e-mailben kapott fizetési kódot. A rendszer a kód alapján
          betölti az ajánlatod adatait, és először megmutatja, hogy melyik
          meccsre, kinek a nevére és milyen összegben fizetsz. Csak ezután
          irányítunk át a SimplePay biztonságos bankkártyás fizetőoldalára.
        </p>

        <div class="mb-4">
          <label
            for="paymentCode"
            class="block text-sm font-semibold text-gray-700 mb-1"
          >
            Fizetési kód
          </label>
          <input
            type="text"
            id="paymentCode"
            placeholder="pl. JEGY-8F2K9Q"
            class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500"
          />
        </div>

        <div
          id="paymentInfo"
          class="hidden mb-4 text-sm text-gray-800 bg-white border border-gray-200 rounded-lg px-3 py-2 whitespace-pre-line"
        >
          <!-- Ide írjuk majd: Meccs, Név, Összeg -->
        </div>

        <button
          id="payButton"
          class="w-full bg-red-600 hover:bg-gradient-to-r hover:from-red-500 hover:to-red-700 text-white font-semibold py-2.5 rounded-full transition duration-300 flex items-center justify-center gap-2"
        >
          Tovább a bankkártyás fizetéshez
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M13 7l5 5m0 0l-5 5m5-5H6"
            />
          </svg>
        </button>

        <p
          id="paymentError"
          class="mt-4 text-sm text-red-600 font-medium hidden"
        ></p>

        <p class="mt-6 text-xs text-gray-500 text-center">
          A fizetés a SimplePay biztonságos rendszerén keresztül történik. Mi
          bankkártyaadatot nem látunk és nem tárolunk.
        </p>
      </div>
    </section>

    <!-- Footer -->
    <footer
      id="contact"
      class="bg-gray-900 text-gray-300 py-10 text-center mt-10"
    >
      <p class="text-lg font-semibold mb-1">UtazzMeccsre</p>

      <p class="text-sm">
        Ha kérdésed van, írj nekünk:
        <a
          href="mailto:utazzmeccsre@gmail.com"
          class="text-red-500 hover:underline"
        >
          utazzmeccsre@gmail.com
        </a>
      </p>

      <div class="flex justify-center gap-6 mt-4 text-sm">
        <a href="aszf.html" class="hover:text-white hover:underline">ÁSZF</a>
        <a href="impresszum.html" class="hover:text-white hover:underline"
          >Impresszum</a
        >
        <a href="adatvedelem.html" class="hover:text-white hover:underline"
          >Adatvédelmi tájékoztató</a
        >
      </div>

      <p class="text-xs text-gray-500 mt-4">
        © 2025 UtazzMeccsre – Minden jog fenntartva.
      </p>
    </footer>

    <!-- Script: kétlépcsős fizetés + kód ellenőrzés -->
    <script>
      const payButton = document.getElementById("payButton");
      const codeInput = document.getElementById("paymentCode");
      const errorEl = document.getElementById("paymentError");
      const infoEl = document.getElementById("paymentInfo");
      const selectorDesktop = document.getElementById("currencySelector");
      const selectorMobile = document.getElementById("currencySelectorMobile");

      let paymentReady = false;
      let lastPaymentData = null;

      payButton.addEventListener("click", async () => {
        const code = codeInput.value.trim();

        errorEl.classList.add("hidden");
        errorEl.textContent = "";

        // Ha már megvan a SimplePay URL → második kattintás → átirányítás
        if (paymentReady && lastPaymentData && lastPaymentData.paymentUrl) {
          window.location.href = lastPaymentData.paymentUrl;
          return;
        }

        // Első kattintás: kód ellenőrzése + adatok megjelenítése
        if (!code) {
          errorEl.textContent = "Kérlek, írd be a fizetési kódot.";
          errorEl.classList.remove("hidden");
          return;
        }

        paymentReady = false;
        lastPaymentData = null;
        infoEl.classList.add("hidden");
        infoEl.textContent = "";

        payButton.disabled = true;
        payButton.classList.add("opacity-70");
        payButton.textContent = "Kód ellenőrzése...";

        try {
          const res = await fetch("/simplepay/start", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ code }),
          });

          const data = await res.json();

          if (!res.ok || data.error) {
            errorEl.textContent =
              data.error || "Ismeretlen hiba történt a fizetés indításakor.";
            errorEl.classList.remove("hidden");
          } else {
            // kiírjuk: meccs, név, összeg
            const desc = data.description || "Meccsjegy csomag";
            const name = data.buyerName || "Név nincs megadva";
            const amount = data.amount ? `${data.amount} Ft` : "";

            let text = "";
            text += `Meccs: ${desc}\n`;
            text += `Név: ${name}`;
            if (amount) text += `\nFizetendő összeg: ${amount}`;

            infoEl.textContent = text;
            infoEl.classList.remove("hidden");

            paymentReady = true;
            lastPaymentData = data;

            payButton.textContent = "Megerősítem, fizetek SimplePay-en";
          }
        } catch (e) {
          console.error(e);
          errorEl.textContent =
            "Hálózati hiba történt. Próbáld meg újra később.";
          errorEl.classList.remove("hidden");
        } finally {
          payButton.disabled = false;
          payButton.classList.remove("opacity-70");
          if (!paymentReady) {
            payButton.innerHTML =
              'Tovább a bankkártyás fizetéshez <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7l5 5m0 0l-5 5m5-5H6"/></svg>';
          }
        }
      });

      // pénznemváltó szinkron (itt csak dizájn)
      if (selectorDesktop) {
        selectorDesktop.addEventListener("change", (e) => {
          if (selectorMobile) selectorMobile.value = e.target.value;
        });
      }
      if (selectorMobile) {
        selectorMobile.addEventListener("change", (e) => {
          if (selectorDesktop) selectorDesktop.value = e.target.value;
        });
      }
    </script>
  </body>
</html>
